# Day 2: Dive!

## Section

<!-- livebook:{"livebook_object":"cell_input","name":"Input","type":"textarea","value":"forward 4\ndown 9\nforward 2\nforward 2\ndown 7\nup 2\ndown 9\nup 8\ndown 7\ndown 9\nforward 4\nup 6\ndown 2\ndown 5\ndown 1\ndown 5\nforward 2\nup 4\nforward 2\nforward 3\nup 2\nforward 6\nup 8\nforward 8\ndown 8\nup 8\ndown 7\ndown 2\ndown 9\nforward 2\nforward 9\ndown 4\nforward 8\nup 6\ndown 3\nup 9\nforward 1\nforward 6\nup 3\nforward 8\nup 9\nforward 1\ndown 9\ndown 3\ndown 7\nup 2\nup 7\ndown 5\nforward 3\ndown 1\nup 6\ndown 2\nforward 4\ndown 6\ndown 8\nforward 2\ndown 5\nforward 6\ndown 5\ndown 7\nforward 8\nforward 2\ndown 9\nup 4\nforward 6\nforward 4\nup 6\ndown 9\ndown 7\ndown 9\nforward 9\nforward 8\ndown 7\nup 7\nforward 9\nforward 8\nup 1\nup 4\ndown 3\nforward 6\nup 6\ndown 2\nup 3\ndown 6\ndown 5\nforward 8\nforward 3\nforward 8\ndown 4\ndown 4\ndown 5\nforward 6\ndown 5\nforward 6\ndown 2\ndown 5\nup 4\ndown 8\nup 5\nforward 5\nforward 6\ndown 9\nup 5\ndown 2\nforward 5\ndown 7\nup 7\ndown 9\nforward 2\ndown 3\ndown 3\nforward 8\nup 5\nup 1\nforward 1\nforward 3\ndown 5\nforward 8\nforward 7\nforward 8\ndown 5\ndown 8\nup 2\nforward 8\nforward 8\ndown 7\nforward 1\nforward 7\ndown 6\nup 4\nforward 7\nforward 7\ndown 3\nup 7\nforward 2\ndown 7\ndown 4\nforward 5\ndown 8\nforward 9\ndown 7\nforward 5\nup 6\nup 6\ndown 8\ndown 3\nforward 5\nforward 3\ndown 8\nup 7\nforward 8\nup 6\ndown 2\nforward 4\nup 3\nup 3\ndown 9\ndown 9\nup 1\nup 7\nforward 2\ndown 1\nforward 9\nup 7\nup 6\ndown 2\ndown 3\nforward 4\ndown 3\ndown 3\ndown 1\nforward 4\nforward 8\nforward 6\nforward 3\nup 4\nup 5\nup 4\nforward 1\nup 3\ndown 9\nup 6\nforward 2\ndown 5\ndown 1\nforward 8\nforward 2\ndown 6\nup 5\nup 3\nforward 7\nforward 2\nforward 7\nup 9\nforward 3\nup 9\nforward 1\ndown 9\nforward 9\ndown 3\ndown 3\ndown 2\nforward 9\nforward 2\nup 3\nforward 3\ndown 7\ndown 3\nforward 2\nforward 1\nforward 6\nup 9\nforward 4\ndown 9\ndown 8\nup 3\nup 5\nforward 8\ndown 9\nforward 5\nforward 4\ndown 5\nup 4\nforward 7\nforward 3\ndown 9\nforward 7\ndown 2\ndown 7\nforward 3\nup 3\nforward 7\ndown 9\ndown 4\ndown 8\nforward 8\ndown 6\nforward 9\nforward 4\nup 9\ndown 9\ndown 6\nup 7\nup 2\nforward 2\nforward 7\ndown 7\nforward 9\ndown 6\ndown 2\nforward 4\nforward 8\ndown 4\nforward 4\nforward 4\nforward 6\nup 6\ndown 9\ndown 3\ndown 7\nup 2\nup 2\nforward 4\ndown 4\nforward 6\ndown 2\ndown 2\nforward 1\ndown 1\nforward 7\nup 5\nforward 9\nforward 8\ndown 4\nforward 8\ndown 5\nup 4\ndown 8\nforward 4\nforward 7\ndown 9\ndown 3\nforward 6\ndown 6\nforward 6\ndown 9\ndown 6\nforward 5\nforward 5\nup 9\ndown 9\ndown 9\ndown 1\ndown 5\nforward 5\ndown 7\nforward 3\ndown 6\nforward 5\nforward 8\ndown 6\nforward 7\ndown 5\nforward 4\ndown 4\ndown 9\nforward 3\ndown 9\ndown 9\ndown 1\nup 7\nforward 4\nup 1\nup 1\nforward 1\ndown 9\nup 8\ndown 8\ndown 3\ndown 7\nforward 4\ndown 5\ndown 5\nforward 7\nforward 7\nforward 6\nup 2\ndown 4\nforward 8\nforward 3\nforward 3\nforward 2\nforward 4\nup 9\nup 1\nforward 2\nforward 2\nforward 6\ndown 9\nup 8\nforward 4\nforward 5\nforward 4\ndown 4\ndown 8\nforward 6\ndown 8\nforward 9\nforward 8\ndown 1\ndown 2\nforward 2\nup 4\nup 7\nforward 5\ndown 7\ndown 5\ndown 3\nup 7\ndown 4\nforward 8\nup 8\ndown 1\ndown 2\nup 6\nup 8\nforward 9\ndown 5\ndown 2\nforward 5\nforward 4\nup 6\nforward 7\ndown 3\nup 5\nup 9\nforward 5\nforward 1\ndown 6\ndown 7\nforward 9\ndown 8\ndown 2\nforward 9\nforward 2\ndown 3\nforward 9\ndown 3\ndown 9\nup 3\nforward 7\nup 2\nup 5\nforward 3\ndown 9\nup 1\ndown 2\ndown 4\ndown 6\nforward 5\nforward 5\nup 7\nup 3\ndown 1\ndown 1\nup 8\ndown 4\nforward 1\ndown 4\ndown 5\ndown 9\nforward 7\nup 2\nup 1\ndown 7\nforward 9\nforward 9\nforward 8\nforward 9\ndown 5\nforward 9\nforward 9\nup 9\ndown 7\ndown 8\nforward 2\nforward 9\ndown 1\nforward 3\nforward 8\nup 4\ndown 4\nforward 4\nforward 3\ndown 7\ndown 3\nforward 6\nforward 9\nforward 1\ndown 2\nup 3\ndown 9\nforward 5\nforward 6\nforward 8\nup 2\nup 1\ndown 3\nup 4\nforward 1\nup 9\nforward 4\ndown 1\nup 2\ndown 8\ndown 9\nforward 3\ndown 2\nup 5\nforward 2\ndown 6\ndown 5\ndown 8\ndown 3\ndown 7\ndown 2\nforward 8\ndown 9\nup 7\ndown 7\ndown 7\ndown 7\nforward 4\nforward 1\nforward 9\nup 9\nforward 5\nforward 8\nforward 7\nforward 7\ndown 1\nforward 3\ndown 7\nforward 2\nforward 4\nup 7\nforward 1\ndown 5\nforward 5\nforward 1\ndown 8\nforward 7\nforward 2\nup 3\ndown 1\nup 7\ndown 1\ndown 2\nforward 9\nforward 6\nforward 3\nforward 2\ndown 4\nforward 7\nforward 7\nforward 5\nforward 7\nforward 2\ndown 9\ndown 8\nforward 8\nforward 9\ndown 3\nup 7\nup 1\ndown 4\nforward 2\nforward 7\nforward 3\nforward 9\nup 2\ndown 3\nforward 4\ndown 8\ndown 6\ndown 4\ndown 6\ndown 7\nforward 9\ndown 9\nforward 8\ndown 1\ndown 1\nforward 1\nforward 1\ndown 7\ndown 3\ndown 3\nforward 2\ndown 7\nforward 8\nup 7\ndown 5\nforward 7\nforward 9\ndown 2\nforward 9\nforward 3\nforward 9\nforward 9\ndown 3\nforward 1\nforward 7\nup 8\nforward 7\nforward 4\nforward 5\nforward 6\ndown 4\nup 3\ndown 5\nup 8\nup 5\nup 6\nforward 1\ndown 1\nup 8\ndown 8\ndown 5\nforward 8\nup 9\ndown 8\nforward 2\nup 6\nforward 3\ndown 3\ndown 8\ndown 4\nforward 6\nforward 2\ndown 9\nup 9\ndown 2\ndown 9\nup 1\ndown 6\nup 2\ndown 9\nforward 8\nforward 3\nforward 6\ndown 6\nup 9\nup 8\nforward 4\ndown 2\nforward 5\nup 4\nup 4\ndown 5\ndown 9\nforward 3\ndown 1\nforward 1\nforward 6\nforward 2\ndown 7\nforward 7\nup 5\nforward 2\ndown 8\nforward 5\ndown 1\ndown 7\nforward 7\ndown 4\nforward 7\nforward 2\ndown 6\nforward 9\nforward 4\nup 3\nforward 8\nforward 2\nup 6\nup 3\nforward 9\nforward 4\ndown 2\nforward 6\ndown 1\nforward 5\ndown 2\nup 1\ndown 1\nforward 2\nforward 4\ndown 7\nup 6\nforward 4\nforward 7\nup 8\nforward 3\ndown 8\nforward 7\ndown 2\ndown 5\nforward 3\nforward 7\ndown 5\nforward 2\nforward 8\nup 6\nforward 8\ndown 7\nup 3\ndown 2\nforward 2\ndown 8\ndown 2\nup 5\nup 1\nforward 6\ndown 1\nforward 2\ndown 1\nforward 6\nforward 9\ndown 9\ndown 8\ndown 3\nforward 5\nforward 3\ndown 3\ndown 1\nforward 4\nforward 8\nforward 2\ndown 7\nforward 9\nforward 4\ndown 4\nforward 6\ndown 4\nforward 8\ndown 8\ndown 2\nup 7\ndown 9\ndown 5\nup 4\ndown 3\nup 5\nforward 8\ndown 4\ndown 6\nforward 1\nup 2\ndown 6\nforward 4\ndown 8\nforward 1\nup 7\nforward 6\nup 2\nforward 1\ndown 8\ndown 2\nforward 3\ndown 3\ndown 2\nup 9\ndown 3\ndown 4\ndown 3\nforward 9\ndown 6\nforward 8\nforward 8\ndown 1\nforward 8\ndown 5\nup 9\nup 5\nup 5\nforward 5\nforward 4\ndown 7\ndown 6\nforward 9\nup 4\nforward 7\nup 5\nforward 7\ndown 5\ndown 3\nforward 5\ndown 8\nup 3\nforward 4\nup 2\ndown 1\ndown 6\ndown 6\nup 3\nforward 5\nforward 8\ndown 2\nforward 6\ndown 5\ndown 4\nforward 9\ndown 6\nforward 6\nup 5\nforward 4\nforward 5\nforward 1\nup 6\nup 2\ndown 8\nup 4\nup 2\ndown 3\nforward 4\ndown 5\nforward 8\nup 5\nforward 6\nforward 9\ndown 6\ndown 3\nup 3\ndown 2\nup 9\nforward 5\nup 5\nforward 3\nforward 2\ndown 5\nup 2\ndown 5\nforward 8\nforward 2\ndown 1\nup 2\ndown 6\nup 8\ndown 3\ndown 2\nforward 2\ndown 1\nforward 8\nforward 2\nup 6\nforward 6\nup 3\nup 8\nup 2\nup 4\ndown 7\nforward 6\ndown 3\ndown 2\nforward 5\ndown 7\ndown 6\nforward 1\ndown 4\nforward 4\nup 1\ndown 3\nup 3\ndown 4\nforward 1\ndown 2\nforward 6\ndown 7\nforward 3\nforward 1\nforward 5\ndown 7\ndown 9\nforward 7\nforward 2\nforward 7\nforward 8\ndown 1\ndown 1\nup 6\nforward 2\nup 7\ndown 9\nup 4\nup 9\nforward 9\nforward 6\ndown 3\ndown 9\nforward 1\nforward 1\nup 8\nforward 6\nforward 1\nforward 9\ndown 2\ndown 1\nforward 2\nforward 9\ndown 9\ndown 6\nforward 5\ndown 6\nforward 4\ndown 3\nforward 1\ndown 4\nup 5\nforward 6\nforward 3\ndown 2\nup 3\ndown 9\ndown 2\nforward 1\ndown 4\nup 2\ndown 6\nforward 6\nforward 7\nforward 3\nforward 9\nup 7\nup 2\nforward 2\nup 2\nforward 1\nup 2\nforward 8\nforward 5\ndown 6\nup 7\ndown 4\ndown 1\nup 8\nforward 1\ndown 3\nup 8\nforward 8\ndown 6\ndown 1\ndown 6\nforward 1\nforward 7\nup 3\nforward 6\nforward 1\nup 3\ndown 5\ndown 1\nforward 5\ndown 5\nup 7\nup 3\ndown 6\nforward 6\nup 7\nforward 5\nforward 2\nforward 1\ndown 8\nforward 3\ndown 3\nforward 5\ndown 4\nup 4\ndown 8\ndown 7\ndown 7\nup 9\nup 2\ndown 4\ndown 1\ndown 4\nforward 9\nup 8\nup 4\ndown 2\nforward 8\nforward 1\ndown 2\nup 5\ndown 3\ndown 8\ndown 8\ndown 6\ndown 5\nforward 7\ndown 3\nforward 5\ndown 6\ndown 9\ndown 2\nforward 8\ndown 4\nup 2\nforward 4\ndown 8\ndown 5\ndown 4\nforward 2\nup 3\nforward 4\nup 3\ndown 8\ndown 2\nup 8\nforward 4\nforward 6\ndown 3\nforward 9\nforward 6\nforward 8\nforward 5\nforward 1\nforward 5\ndown 3\nup 2\nforward 4\ndown 4\ndown 3\nforward 1\nforward 3\nforward 7\nforward 9\ndown 2\nup 4\ndown 3\nup 8\nforward 9\ndown 5\nup 9\ndown 1\nup 4\nforward 7\nforward 2\nforward 4\nup 8\ndown 4\ndown 1\nforward 8\ndown 4\ndown 7\nup 1\ndown 3\ndown 2\nforward 5\nup 6\ndown 7\nforward 2"} -->

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
defmodule Setup do
  ## parsing the input, converting it to a list of lines
  def get_input(prompt) do
    case IO.gets(prompt) do
      :eof -> ""
      line -> line <> get_input(prompt)
    end
  end

  def parse_input(input) do
    input
    |> String.split("\n", trim: true)
    |> Enum.map(&parse_line/1)
  end

  defp parse_line("forward " <> units), do: {:forward, String.to_integer(units)}
  defp parse_line("down " <> units), do: {:down, String.to_integer(units)}
  defp parse_line("up " <> units), do: {:up, String.to_integer(units)}
end

input =
  Setup.get_input("Input")
  |> Setup.parse_input()
```

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
defmodule Submarine do
  def position(instructions, pos \\ {0, 0}) do
    {x, y} = Enum.reduce(instructions, pos, &move/2)
    x * y
  end

  defp move({:forward, unit}, {x, y}), do: {x + unit, y}
  defp move({:down, unit}, {x, y}), do: {x, y + unit}
  defp move({:up, unit}, {x, y}), do: {x, y - unit}
end
```

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
Submarine.position(input)
```

## Part 2

```elixir
defmodule Submarine2 do
  def position(instructions, pos \\ {0, 0, 0}) do
    {_, x, y} = Enum.reduce(instructions, pos, &move/2)
    x * y
  end

  def move({:forward, unit}, {a, x, y}), do: {a, x + unit, y + a * unit}
  def move({:down, unit}, {a, x, y}), do: {a + unit, x, y}
  def move({:up, unit}, {a, x, y}), do: {a - unit, x, y}
end
```

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
Submarine2.position(input)
```

## Test

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
ExUnit.start()

defmodule Test do
  use ExUnit.Case

  setup do
    {:ok,
     input:
       Setup.parse_input("""
       forward 5
       down 5
       forward 8
       up 3
       down 8
       forward 2
       """)}
  end

  test "setup", %{input: input} do
    assert input ==
             [
               forward: 5,
               down: 5,
               forward: 8,
               up: 3,
               down: 8,
               forward: 2
             ]
  end

  test "position", %{input: input} do
    assert Submarine.position(input) == 150
  end

  test "position2", %{input: input} do
    assert Submarine2.position(input) == 900
  end
end

ExUnit.run()
```

## Animate descent

```elixir
Mix.install([:vega_lite, :kino])

alias VegaLite, as: Vl
```

```elixir
widget =
  Vl.new(width: 400, height: 400)
  |> Vl.mark(:line)
  |> Vl.encode_field(:x, "position", type: :quantitative)
  |> Vl.encode_field(:y, "depth", type: :quantitative)
  |> Kino.VegaLite.new()
  |> tap(&Kino.render/1)

Enum.reduce(input, {0, 0, 0}, fn instr, pos ->
  {_, x, y} = pos = Submarine2.move(instr, pos)

  point = %{"position" => x, "depth" => -y}
  Kino.VegaLite.push(widget, point, window: 2000)
  Process.sleep(25)

  pos
end)
```
